<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Chussy Inferno 3D</title>
    <style>
        body { 
            margin: 0; 
            background: #000;
            overflow: hidden;
        }
        canvas { 
            width: 100vw;
            height: 100vh;
        }
        .ceo-approval {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 2;
            text-align: center;
            color: #ff4400;
            text-shadow: 0 0 10px #ff0000;
        }
        .ceo-approval img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 2px solid #ff4400;
            box-shadow: 0 0 10px #ff0000;
        }
        .tos-link {
            position: fixed;
            bottom: 10px;
            right: 10px;
            color: #ff4400;
            text-decoration: none;
            font-family: 'Comic Sans MS', cursive;
            text-shadow: 0 0 5px #ff0000;
            z-index: 2;
        }
    </style>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-YOURPUBID"></script>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <div class="ceo-approval">
        <p>I approve of this webpage</p>
        <img src="https://avatars.githubusercontent.com/u/4442245" alt="ThePrimeagen CEO">
    </div>
    <a href="termsofservice.html" class="tos-link">Sussy Terms of Service</a>
    <!-- IE Compatibility polyfills -->
    <script>
        if (!window.requestAnimationFrame) {
            window.requestAnimationFrame = function(callback) {
                return setTimeout(callback, 1000 / 60);
            };
        }
        if (!Array.prototype.forEach) {
            Array.prototype.forEach = function(callback) {
                for (var i = 0; i < this.length; i++) {
                    callback(this[i], i, this);
                }
            };
        }
    </script>
    <script>
        // Game state
        const state = {
            projectiles: [],
            enemies: []
        };

        // Map data
        const MAP = [
            [1,1,1,1,1,1,1,1],
            [1,0,0,0,0,0,0,1],
            [1,0,1,0,0,1,0,1],
            [1,0,0,0,0,0,0,1],
            [1,0,1,0,0,1,0,1],
            [1,0,0,0,0,0,0,1],
            [1,0,1,0,0,1,0,1],
            [1,1,1,1,1,1,1,1]
        ];

        // Player state
        const player = {
            x: 1.5,
            y: 1.5,
            angle: 0,
            fov: Math.PI / 3,
            speed: 0.15,  // Increased speed for smoother movement
            turnSpeed: 0.12  // Increased turn speed for better control
        };

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // Raycasting
        function castRay(rayAngle) {
            let rayX = player.x;
            let rayY = player.y;
            let rayDirX = Math.cos(rayAngle);
            let rayDirY = Math.sin(rayAngle);
            
            let distance = 0;
            while (distance < 20) {
                rayX += rayDirX * 0.1;
                rayY += rayDirY * 0.1;
                distance += 0.1;
                
                let mapX = Math.floor(rayX);
                let mapY = Math.floor(rayY);
                
                if (MAP[mapY] && MAP[mapY][mapX] === 1) {
                    return distance;
                }
            }
            return distance;
        }

        function drawFrame() {
            // Clear screen with dark gradient for atmosphere
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#000');
            gradient.addColorStop(1, '#111');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Optimize raycasting
            const numRays = Math.floor(canvas.width / 2); // Reduced for better performance
            const rayStep = player.fov / numRays;
            
            for (let i = 0; i < numRays; i++) {
                const rayAngle = player.angle - player.fov/2 + rayStep * i;
                const distance = castRay(rayAngle);
                const wallHeight = canvas.height / distance;
                
                ctx.fillStyle = `rgb(${255/distance}, ${255/distance}, ${255/distance})`;
                ctx.fillRect(i, (canvas.height-wallHeight)/2, 1, wallHeight);
            }
            
            requestAnimationFrame(drawFrame);
        }

        // Input handling
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case 'w':
                    player.x += Math.cos(player.angle) * player.speed;
                    player.y += Math.sin(player.angle) * player.speed;
                    break;
                case 's':
                    player.x -= Math.cos(player.angle) * player.speed;
                    player.y -= Math.sin(player.angle) * player.speed;
                    break;
                case 'a':
                    player.angle -= player.turnSpeed;
                    break;
                case 'd':
                    player.angle += player.turnSpeed;
                    break;
                case ' ':
                    // Enhanced shooting mechanic
                    state.projectiles.push({
                        x: player.x,
                        y: player.y,
                        angle: player.angle,
                        speed: 0.5,
                        damage: 50
                    });
                    break;
            }
        });

        drawFrame();
    </script>
</body>
</html>
